import{c as ce,j as e,r as x,P as N,B as u,G as re,R as I,T as g,b as G,C as oe,I as xe,J as fe,K as Q}from"./index-hGdQ2r_V.js";import{u as ge,c as A,g as he,a as be,b as T,D as U,B as je,T as ne}from"./Web3Context-noHjqmGc.js";import{L as F}from"./LightTooltip-CRSkSbnV.js";import{k as J,D as _,b as H,c as L,m as Z,T as se,d as Y,n as ye,l as ae,A as K,o as we}from"./PageFragment-BbhFdBYF.js";import{D as ie}from"./DialogContentText-1VsnJ7S5.js";import{I as Ce}from"./InputAdornment-B0NlKv-F.js";import{g as ve}from"./EcosystemDropdown-SwQtU666.js";import"./Tooltip-B1iTXLt4.js";import"./Popper-D8FfNRIJ.js";import"./CenteredLoading-DQRUjEko.js";const Se=ce(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),De=ce(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),m={gridSize:4,totalCells:12,numParticles:20,particleBaseSizeXs:"10px",particleBaseSizeSm:"14px",collectionAnimationDuration:700*2,particleEffectDuration:1500*2,dollarDecimalPlaces:4,ethAddressDisplayLength:10,gemTiers:[{name:"Bronze",color:"#CD7F32",dollarAmount:.01,iconSize:{xs:28,sm:35,md:40}},{name:"Silver",color:"#C0C0C0",dollarAmount:.05,iconSize:{xs:34,sm:42,md:50}},{name:"Gold",color:"#FFD700",dollarAmount:.1,iconSize:{xs:40,sm:50,md:60}},{name:"Epic",color:"#E040FB",dollarAmount:.25,iconSize:{xs:48,sm:60,md:75}}],localStorageKey:"datamineGemsConfig"},le=m.gemTiers.reduce((r,p)=>(r[p.name]=p.dollarAmount,r),{}),Te=(r,p)=>{let l;const h=m.gemTiers.map(a=>({...a,configuredDollarAmount:p[a.name]??a.dollarAmount})).sort((a,c)=>a.configuredDollarAmount-c.configuredDollarAmount);for(const a of h)if(r>=a.configuredDollarAmount)l=a;else break;return!l&&h.length>0?h[0]:l},Ae=Q`
  0%, 100% { transform: translateX(0) rotate(0); }
  10%, 50%, 90% { transform: translateX(-1px) rotate(-1deg); }
  30%, 70% { transform: translateX(1px) rotate(1deg); }
`,ke=Q`
  0%, 100% { filter: brightness(100%) drop-shadow(1px 1px 2px rgba(0,0,0,0.3)); transform: scale(1); }
  50% { filter: brightness(170%) drop-shadow(2px 2px 5px rgba(255,255,255,0.7)); transform: scale(1.05); }
`,Ge=Q`
  0% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
  100% { transform: translate(var(--target-x), var(--target-y)) scale(0); opacity: 0; }
`,Ee=I.memo(({color:r,delay:p,duration:l,targetX:h,targetY:a})=>e.jsx(u,{sx:{position:"absolute",top:"50%",left:"50%",width:{xs:m.particleBaseSizeXs,sm:m.particleBaseSizeSm},height:{xs:m.particleBaseSizeXs,sm:m.particleBaseSizeSm},backgroundColor:r,borderRadius:"50%",boxShadow:`0 0 7px ${r}, 0 0 12px ${r}`,"--target-x":h,"--target-y":a,animation:`${Ge} ${l}s cubic-bezier(0.1, 0.7, 0.3, 1) ${p}s forwards`,pointerEvents:"none"}})),Be=I.memo(({gemContent:r,itemIndex:p,onAttemptCollect:l,currentGemValues:h})=>{const a=x.useMemo(()=>({width:{xs:60,sm:80,md:100},height:{xs:60,sm:80,md:100},display:"flex",alignItems:"center",justifyContent:"center",borderRadius:2,boxSizing:"border-box",position:"relative"}),[]),{displayTier:c,computedProgress:v,showProgressBar:i,progressTargetTierConfiguredValue:S,progressTargetTierName:D}=x.useMemo(()=>{if(!r)return{displayTier:void 0,computedProgress:0,showProgressBar:!1,progressTargetTierConfiguredValue:0,progressTargetTierName:null};const f=m.gemTiers[0],y=h[f.name]??f.dollarAmount;let E=0,k=!1,z=null,B=0;const P=Te(r.dollarAmount,h);return r.dollarAmount<y&&y>0?(E=r.dollarAmount/y*100,k=!0,z=f.name,B=y):k=!1,{displayTier:P||f,computedProgress:Math.min(100,E),showProgressBar:k,progressTargetTierConfiguredValue:B,progressTargetTierName:z}},[r,h]),d=x.useMemo(()=>r&&!r.isCollecting&&!r.error&&r.dollarAmount>0,[r]),w=x.useCallback(()=>{d&&r&&l(r)},[r,l,d]),C=x.useMemo(()=>{if(r){const f=r.ethereumAddress.substring(0,m.ethAddressDisplayLength)+"...";if(r.error)return e.jsxs(I.Fragment,{children:[e.jsx(g,{variant:"caption",display:"block",color:"error",children:r.error}),e.jsxs(g,{variant:"caption",display:"block",color:"error",children:["Address: ",f]})]});if(d)return e.jsxs(I.Fragment,{children:[e.jsxs(g,{variant:"caption",display:"block",children:["Click to Collect Reward: $",r.dollarAmount.toFixed(m.dollarDecimalPlaces)]}),e.jsxs(g,{variant:"caption",display:"block",children:["Address: ",f]})]});if(i&&D)return e.jsxs(I.Fragment,{children:[e.jsxs(g,{variant:"caption",display:"block",children:["Progress to $",S.toFixed(m.dollarDecimalPlaces)," reward:"," ",Math.floor(v),"%"]}),e.jsxs(g,{variant:"caption",display:"block",children:["Address: ",f]})]});if(c)return e.jsxs(I.Fragment,{children:[e.jsxs(g,{variant:"caption",display:"block",children:[c.name," Gem"]}),e.jsxs(g,{variant:"caption",display:"block",children:["Value: $",r.dollarAmount.toFixed(m.dollarDecimalPlaces)]}),e.jsxs(g,{variant:"caption",display:"block",children:["Address: ",f]}),e.jsx(g,{variant:"caption",display:"block",sx:{opacity:.7},children:"(Cannot collect)"})]})}return"Empty Slot"},[r,c,i,v,S,D,d]);if(!r)return e.jsx(F,{title:"Empty Slot",placement:"top",arrow:!0,children:e.jsx(N,{sx:{...a,backgroundColor:"transparent",opacity:.6}})});if(r.error)return e.jsx(F,{title:C,placement:"top",arrow:!0,children:e.jsxs(N,{sx:{...a,backgroundColor:"transparent",cursor:d?"pointer":"default"},onClick:w,children:[e.jsx(oe,{variant:"determinate",value:100,size:typeof a.width=="object"?a.width.xs:a.width,sx:{color:xe[500],position:"absolute"}}),e.jsx(g,{variant:"caption",component:"div",color:"error",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.7rem",zIndex:1,fontWeight:"bold"},children:"?"})]})});if(!c)return console.warn("Could not determine tier for gem:",r),e.jsx(F,{title:"Error: Unknown Gem Type",placement:"top",arrow:!0,children:e.jsx(N,{sx:{...a,backgroundColor:"transparent",opacity:.6}})});if(i)return e.jsx(F,{title:C,placement:"top",arrow:!0,children:e.jsxs(N,{sx:{...a,backgroundColor:"transparent",cursor:d?"pointer":"default"},onClick:w,children:[e.jsx(oe,{variant:"determinate",value:v,size:typeof a.width=="object"?a.width.xs:a.width,sx:{color:fe[700],position:"absolute"}}),e.jsx(g,{variant:"caption",component:"div",color:"text.secondary",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.7rem",zIndex:1},children:`${Math.floor(v)}%`})]})});const b=!r.isCollecting;return e.jsx(F,{title:C,placement:"top",arrow:!0,children:e.jsxs(J,{"aria-label":`${c.name} Gem ($${r.dollarAmount.toFixed(m.dollarDecimalPlaces)})`,onClick:w,disabled:!d||r.isCollecting,sx:{...a,padding:0,overflow:"visible",animation:d&&b?`${Ae} 2s ease-in-out infinite`:"none","&:hover":{backgroundColor:d&&b?"action.hover":"transparent"}},children:[e.jsx(Z,{sx:{fontSize:c.iconSize,color:c.color,transition:"transform 0.2s ease-in-out, filter 0.3s ease-in-out",animation:d&&b?`${ke} 2.2s ease-in-out infinite 0.3s`:"none","&:hover":{transform:d&&b?"scale(1.15)":"none",filter:d&&b?"brightness(120%) drop-shadow(1px 1px 3px rgba(0,0,0,0.4))":void 0}}}),r.isCollecting&&Array.from({length:m.numParticles}).map((f,y)=>e.jsx(Ee,{color:c.color,delay:Math.random()*.25,duration:.8+Math.random()*.7,targetX:`${(Math.random()-.5)*(Math.random()*150+70)}px`,targetY:`${(Math.random()-.5)*(Math.random()*150+70)}px`},y))]})})}),Ie=({initialGems:r,onAttemptCollectGem:p,onAddGem:l,gemsCollected:h,totalCollectedBalance:a})=>{const[c,v]=x.useState(()=>{try{const t=localStorage.getItem(m.localStorageKey);if(t){const n=JSON.parse(t);let o=!0;for(const s of m.gemTiers)if(typeof n[s.name]!="number"){o=!1;break}if(o)return n}}catch(t){console.error("Error loading gem values from localStorage:",t)}return le}),[i,S]=x.useState(r),[D,d]=x.useState(!1),[w,C]=x.useState(!1),[b,f]=x.useState(""),[y,E]=x.useState(Object.entries(c).reduce((t,[n,o])=>(t[n]=String(o),t),{}));x.useEffect(()=>{try{localStorage.setItem(m.localStorageKey,JSON.stringify(c))}catch(t){console.error("Error saving gem values to localStorage:",t)}},[c]),x.useEffect(()=>{E(Object.entries(c).reduce((t,[n,o])=>(t[n]=String(o),t),{}))},[c]),x.useEffect(()=>{S(r)},[r]);const k=x.useCallback((t,n)=>{S(o=>o.map((s,j)=>j===n&&s&&s.id===t.id?{...s,isCollecting:!0}:s)),setTimeout(()=>{S(o=>{const s=[...o];return s[n]&&s[n]?.id===t.id&&(s[n]={...s[n],isCollecting:!1}),s})},m.particleEffectDuration)},[]),z=x.useCallback(t=>{const n=i.findIndex(j=>j?.id===t.id);if(n===-1){console.error("Clicked gem not found in grid:",t);return}if(t.error){p&&p([t]);return}if(!(!t.isCollecting&&!t.error&&t.dollarAmount>0))return;p([t])&&k(t,n)},[p,k,i,c]);x.useCallback(()=>{v(le)},[]);const B=()=>{E(Object.entries(c).reduce((t,[n,o])=>(t[n]=String(o),t),{})),d(!0)},P=()=>{d(!1)},ee=()=>{const t={};let n=!0;for(const o of m.gemTiers){const s=y[o.name];let j=parseFloat(s);if(isNaN(j)||j<0){n=!1,console.error(`Invalid value for ${o.name}: ${s}`);break}j>100&&(j=100),t[o.name]=j}n&&v(t),d(!1)},V=(t,n)=>{E(o=>({...o,[t]:n}))},O=()=>{f(""),C(!0)},M=()=>{C(!1)},R=()=>{l&&b.trim()&&l(b.trim()),M()},$=(()=>{const t=c.Bronze;return i.filter(o=>o&&o?.dollarAmount>t&&!o.error)})(),q=()=>{p($)},X=()=>{if($.length===0)return;const t=$.reduce((n,o)=>n+o.dollarAmount,0);return e.jsxs(G,{onClick:q,color:"secondary",variant:"outlined",children:["Collect All Gems ($ ",t.toFixed(m.dollarDecimalPlaces),")"]})};return e.jsxs(N,{elevation:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",p:{xs:2,sm:3},borderRadius:3,backgroundColor:"background.default",margin:"auto",minWidth:{xs:"95%",sm:380}},children:[e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:"center",mb:2,width:"100%",justifyContent:"space-between"},children:[e.jsx(u,{children:X()}),e.jsxs(u,{sx:{display:"flex"},children:[l&&e.jsx(F,{title:"Add custom Datamine Gem Ethereum address",placement:"top",children:e.jsx(J,{"aria-label":"add gem",onClick:O,size:"small",sx:{mr:.5},children:e.jsx(Se,{})})}),e.jsx(J,{"aria-label":"settings",onClick:B,size:"small",children:e.jsx(De,{})})]})]}),e.jsx(re,{container:!0,spacing:{xs:1,sm:1.5},sx:{width:{xs:190,sm:330},justifyContent:"center",mb:3},children:i.map((t,n)=>e.jsx(re,{size:{xs:3},sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Be,{gemContent:t,itemIndex:n,onAttemptCollect:z,currentGemValues:c})},t?.id||`empty-slot-${n}`))}),e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:"center",flexGrow:1,justifyContent:{xs:"center",sm:"flex-start"}},children:[e.jsxs(g,{variant:"body1",sx:{mr:{sm:2},mb:{xs:1,sm:0},fontWeight:"medium"},children:["Gems Collected: ",h," "]}),e.jsxs(g,{variant:"body1",color:"success.main",sx:{fontWeight:"medium"},children:["Total Collected: $",a.toFixed(m.dollarDecimalPlaces)," "]})]}),e.jsxs(_,{open:D,onClose:P,fullWidth:!0,maxWidth:"xs",children:[e.jsx(H,{children:"Gem Value Settings"}),e.jsxs(L,{children:[e.jsx(ie,{sx:{mb:2},children:"Modify the dollar amount for each gem color."}),m.gemTiers.map(t=>e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Z,{sx:{color:t.color,mr:1.5,fontSize:"24px"}}),e.jsx(se,{margin:"none",label:`${t.name} Value`,type:"number",fullWidth:!0,variant:"outlined",value:y[t.name]||"",onChange:n=>V(t.name,n.target.value),InputProps:{startAdornment:e.jsx(Ce,{position:"start",children:"$"})},inputProps:{step:"0.0001"}})]},t.name))]}),e.jsxs(Y,{children:[e.jsx(G,{onClick:P,children:"Cancel"}),e.jsx(G,{onClick:ee,color:"secondary",variant:"outlined",children:"Save"})]})]}),e.jsxs(_,{open:w,onClose:M,fullWidth:!0,maxWidth:"sm",children:[e.jsx(H,{children:"Add Gem by Address"}),e.jsxs(L,{children:[e.jsx(ie,{sx:{mb:2},children:"Add another Gem by entering Ethereum Address. This gem will be added as your playfield and the address must be participating in the game."}),e.jsx(se,{autoFocus:!0,margin:"dense",id:"new-gem-ethereum",label:e.jsxs(e.Fragment,{children:["Ethereum Add",e.jsx(u,{component:"span",sx:{position:"absolute",left:"-9999px"},children:" "}),"ress"]}),type:"text",fullWidth:!0,variant:"outlined",value:b,onChange:t=>f(t.target.value),autoComplete:"off",inputProps:{autoComplete:"off"}})]}),e.jsxs(Y,{children:[e.jsx(G,{onClick:M,children:"Cancel"}),e.jsx(G,{onClick:R,color:"secondary",variant:"outlined",children:"Add Gem"})]})]})]})},ze=I.memo(({selectedAddress:r,balances:p,dispatch:l,error:h,ecosystem:a,marketAddressLock:c,currentAddresMintableBalance:v,currentAddressMarketAddressLock:i,connectionMethod:S,addressDetails:D,marketAddresses:d,hasWeb3:w,market:C})=>{const{mintableTokenShortName:b,navigation:f,marketAddress:y}=he(a),{isHelpPageEnabled:E}=f,k=async o=>{if(o.preventDefault(),!r){l(w===null?{type:A.commands.Initialize,payload:{address:null}}:{type:A.commands.ConnectToWallet});return}if(!i){console.log("currentAddressMarketAddressLock is null");return}i.rewardsAmount.eq(new T(0))&&l({type:A.commands.ShowDialog,payload:{dialog:U.MarketDepositWithdraw}})},z=()=>{l({type:A.commands.ShowDialog,payload:{dialog:U.MarketDepositWithdraw}})},B=(o=void 0,s=void 0)=>{s!=="backdropClick"&&l({type:A.commands.CloseDialog})},P=()=>{if(!(!i||i.rewardsAmount.eq(new T(0))))return e.jsx(G,{color:"secondary",size:"small",variant:"outlined",onClick:()=>z(),startIcon:e.jsx(u,{display:"flex",style:{color:"#0ff"},children:e.jsx(we,{style:{color:"#00ffff"}})}),children:"Deposit/Withdraw"})},V=(()=>{const o=[];if(!d||!p)return o;for(const s of d.addresses){const j=()=>{if(s.isPaused)return"Error: Address is paused for gem minting (by the address). Please check back later!";if(s.minterAddress!==y)return"Error: This address is not paricipating in public minting."},W=s.mintAmount,me=(()=>{const pe=s.rewardsPercent===0?500:s.rewardsPercent;return W.add(W.mul(new T(pe)).div(new T(1e4)))})(),ue=be({value:me.sub(W),inputToken:ne.Mintable,outputToken:ne.USDC,balances:p,round:6,removeCommas:!0});o.push({ethereumAddress:s.currentAddress,error:j(),dollarAmount:parseFloat(ue),id:s.currentAddress})}return o})();console.log("marketAddresses:",d);const O=o=>i?i.rewardsAmount.eq(new T(0))?(l({type:A.commands.ShowDialog,payload:{dialog:U.MarketDepositWithdraw}}),!1):(l({type:A.commands.Market.MarketBurnFluxTokens,payload:{amountToBurn:new T(0),gems:o}}),!0):(console.log("currentAddressMarketAddressLock is null"),!1),M=o=>{const s=j=>j.toLowerCase().replace(/[^a-f0-9x]/g,"");if(o&&(o=s(o.toLowerCase()),!!o&&o.length===42&&o.startsWith("0x")))return l({type:A.commands.Market.AddGemAddress,payload:{address:o}}),!0},R=()=>{if(h)return e.jsx(K,{variant:"filled",severity:"warning",children:h})},te=()=>i?e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:["My Ethereum Address:"," ",e.jsx(g,{variant:"body2",display:"inline",color:"textSecondary",children:r})]}),e.jsxs(u,{my:1,children:["Gem Game Balance (",b,"):"," ",e.jsxs(g,{variant:"body2",display:"inline",color:"textSecondary",children:[je(i.rewardsAmount,!0)," ",b]})]})]}):e.jsx(e.Fragment,{}),$=()=>{if(D)return e.jsxs(e.Fragment,{children:["Ethereum Block #",D.blockNumber.toLocaleString()]})},q=()=>i?e.jsx(e.Fragment,{children:i.rewardsAmount.eq(new T(0))?"Deposit":"Continue"}):"Connect",X=()=>{if(!(!w||!r))return y?e.jsx(Ie,{initialGems:V,onAttemptCollectGem:O,onAddGem:M,gemsCollected:C.gemsCollected.count,totalCollectedBalance:C.gemsCollected.sumDollarAmount}):e.jsx(K,{severity:"info",children:"Datamine Gems is coming to this ecosystem soon! Please select another ecosystem to continue."})},t=()=>{const s=(()=>{if(!r)return w===null?"Web3 connection required, click Connect button below":"Ethereum based wallet required, click Continue button below.";if(i&&i.rewardsAmount.eq(new T(0)))return e.jsxs(e.Fragment,{children:["Your ",b," Gem Game Balance is 0. Click Deposit button below to continue."]})})();if(s)return e.jsx(u,{mb:3,children:e.jsx(K,{severity:"info",children:s})})},n=()=>{if(!(i&&r&&i.rewardsAmount.gt(new T(0))))return e.jsx(G,{type:"submit",color:"secondary",size:"large",variant:"outlined",children:q()})};return e.jsx(_,{open:!0,onClose:B,"aria-labelledby":"form-dialog-title",children:e.jsxs("form",{onSubmit:k,children:[e.jsx(H,{id:"form-dialog-title",children:e.jsxs(u,{display:"flex",alignItems:"center",alignContent:"center",children:[e.jsx(u,{display:"flex",pr:1,children:e.jsx(Z,{style:{color:"#00ffff"}})}),"Datamine Gems",e.jsx(ye,{size:"small",label:"#GameFi"})]})}),e.jsxs(L,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,children:[e.jsx(u,{display:"flex",alignItems:"center",mr:2,children:ve({ecosystem:a,connectionMethod:S,dispatch:l})}),P()]}),e.jsx(u,{my:2}),te(),e.jsx(u,{my:3,children:e.jsx(ae,{})}),R(),t(),X(),e.jsx(u,{mt:2,children:e.jsx(ae,{})})]}),e.jsxs(Y,{sx:{justifyContent:"space-between",alignItems:"center",px:3,py:1.5},children:[e.jsx(g,{variant:"caption",color:"textSecondary",children:$()}),e.jsxs(u,{children:[" ",e.jsxs(u,{display:"inline-block",mr:1,children:[" ",e.jsx(G,{onClick:B,children:"Cancel"})]}),n()]})]})]})})}),Ue=()=>{const{state:r,dispatch:p}=ge();x.useEffect(()=>{p({type:A.commands.Market.RefreshMarketAddresses,payload:{}})},[]);const{balances:l,address:h,ecosystem:a,marketAddressLock:c,currentAddresMintableBalance:v,currentAddressMarketAddressLock:i,selectedAddress:S,connectionMethod:D,addressDetails:d,marketAddresses:w,error:C,hasWeb3:b,market:f}=r;return e.jsx(ze,{balances:l,selectedAddress:h??S,error:C,dispatch:p,ecosystem:a,marketAddressLock:c,currentAddresMintableBalance:v,currentAddressMarketAddressLock:i,connectionMethod:D,addressDetails:d,marketAddresses:w,hasWeb3:b,market:f})};export{Ue as default};
