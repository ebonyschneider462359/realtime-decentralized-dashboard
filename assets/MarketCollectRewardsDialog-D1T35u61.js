import{j as e,r as p,P as V,B as u,T as y,G as te,R as B,y as pe,z as xe,v as Q}from"./index-B9l7GyFB.js";import{f as le,s as K,D as _,g as H,h as J,w as Z,x as re,i as Y,d as P,y as fe,v as oe,A as L,z as he}from"./PageFragment-DZu0XlKj.js";import{W as ge,c as T,g as ye,f as je,i as E,D as U,B as be,T as se}from"./Web3Context-Bsdl670i.js";import{L as $}from"./LightTooltip-CcteZ0ez.js";import{D as ne}from"./DialogContentText-Cq_DcSbe.js";import{I as we}from"./InputAdornment-CnmfeaHK.js";import{a as ae}from"./CenteredLoading-DE0BhJey.js";import{g as ve}from"./EcosystemDropdown-BNY_gEzM.js";import"./Tooltip-DVny-YBV.js";import"./Popper-CdCRRWbL.js";const Ce=le(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),Se=le(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),m={gridSize:3,totalCells:3*3,numParticles:20,particleBaseSizeXs:"10px",particleBaseSizeSm:"14px",collectionAnimationDuration:700*2,particleEffectDuration:1500*2,dollarDecimalPlaces:4,ethAddressDisplayLength:10,gemTiers:[{name:"Bronze",color:"#CD7F32",dollarAmount:.01,iconSize:{xs:28,sm:35,md:40}},{name:"Silver",color:"#C0C0C0",dollarAmount:.05,iconSize:{xs:34,sm:42,md:50}},{name:"Gold",color:"#FFD700",dollarAmount:.1,iconSize:{xs:40,sm:50,md:60}},{name:"Epic",color:"#E040FB",dollarAmount:.25,iconSize:{xs:48,sm:60,md:75}}],localStorageKey:"datamineGemsConfig"},ie=m.gemTiers.reduce((r,x)=>(r[x.name]=x.dollarAmount,r),{}),De=(r,x)=>{let a;const j=m.gemTiers.map(o=>({...o,configuredDollarAmount:x[o.name]??o.dollarAmount})).sort((o,i)=>o.configuredDollarAmount-i.configuredDollarAmount);for(const o of j)if(r>=o.configuredDollarAmount)a=o;else break;return!a&&j.length>0?j[0]:a},Ae=Q`
  0%, 100% { transform: translateX(0) rotate(0); }
  10%, 50%, 90% { transform: translateX(-1px) rotate(-1deg); }
  30%, 70% { transform: translateX(1px) rotate(1deg); }
`,ke=Q`
  0%, 100% { filter: brightness(100%) drop-shadow(1px 1px 2px rgba(0,0,0,0.3)); transform: scale(1); }
  50% { filter: brightness(170%) drop-shadow(2px 2px 5px rgba(255,255,255,0.7)); transform: scale(1.05); }
`,Te=Q`
  0% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
  100% { transform: translate(var(--target-x), var(--target-y)) scale(0); opacity: 0; }
`,Ge=B.memo(({color:r,delay:x,duration:a,targetX:j,targetY:o})=>e.jsx(u,{sx:{position:"absolute",top:"50%",left:"50%",width:{xs:m.particleBaseSizeXs,sm:m.particleBaseSizeSm},height:{xs:m.particleBaseSizeXs,sm:m.particleBaseSizeSm},backgroundColor:r,borderRadius:"50%",boxShadow:`0 0 7px ${r}, 0 0 12px ${r}`,"--target-x":j,"--target-y":o,animation:`${Te} ${a}s cubic-bezier(0.1, 0.7, 0.3, 1) ${x}s forwards`,pointerEvents:"none"}})),Ee=B.memo(({gemContent:r,itemIndex:x,onAttemptCollect:a,currentGemValues:j})=>{const o=p.useMemo(()=>({width:{xs:60,sm:80,md:100},height:{xs:60,sm:80,md:100},display:"flex",alignItems:"center",justifyContent:"center",borderRadius:2,boxSizing:"border-box",position:"relative"}),[]),{displayTier:i,computedProgress:D,showProgressBar:l,progressTargetTierConfiguredValue:A,progressTargetTierName:k}=p.useMemo(()=>{if(!r)return{displayTier:void 0,computedProgress:0,showProgressBar:!1,progressTargetTierConfiguredValue:0,progressTargetTierName:null};const h=m.gemTiers[0],v=j[h.name]??h.dollarAmount;let I=0,G=!1,F=null,z=0;const M=De(r.dollarAmount,j);return r.dollarAmount<v&&v>0?(I=r.dollarAmount/v*100,G=!0,F=h.name,z=v):G=!1,{displayTier:M||h,computedProgress:Math.min(100,I),showProgressBar:G,progressTargetTierConfiguredValue:z,progressTargetTierName:F}},[r,j]),n=p.useMemo(()=>r&&!r.isCollecting&&!r.error&&r.dollarAmount>0,[r]),C=p.useCallback(()=>{n&&r&&a(r)},[r,a,n]),S=p.useMemo(()=>{if(r){const h=r.ethereumAddress.substring(0,m.ethAddressDisplayLength)+"...";if(r.error)return e.jsxs(B.Fragment,{children:[e.jsx(y,{variant:"caption",display:"block",color:"error",children:r.error}),e.jsxs(y,{variant:"caption",display:"block",color:"error",children:["Address: ",h]})]});if(n)return e.jsxs(B.Fragment,{children:[e.jsxs(y,{variant:"caption",display:"block",children:["Click to Collect Reward: $",r.dollarAmount.toFixed(m.dollarDecimalPlaces)]}),e.jsxs(y,{variant:"caption",display:"block",children:["Address: ",h]})]});if(l&&k)return e.jsxs(B.Fragment,{children:[e.jsxs(y,{variant:"caption",display:"block",children:["Progress to $",A.toFixed(m.dollarDecimalPlaces)," reward: ",Math.floor(D),"%"]}),e.jsxs(y,{variant:"caption",display:"block",children:["Address: ",h]})]});if(i)return e.jsxs(B.Fragment,{children:[e.jsxs(y,{variant:"caption",display:"block",children:[i.name," Gem"]}),e.jsxs(y,{variant:"caption",display:"block",children:["Value: $",r.dollarAmount.toFixed(m.dollarDecimalPlaces)]}),e.jsxs(y,{variant:"caption",display:"block",children:["Address: ",h]}),e.jsx(y,{variant:"caption",display:"block",sx:{opacity:.7},children:"(Cannot collect)"})]})}return"Empty Slot"},[r,i,l,D,A,k,n]);if(!r)return e.jsx($,{title:"Empty Slot",placement:"top",arrow:!0,children:e.jsx(V,{sx:{...o,backgroundColor:"transparent",opacity:.6}})});if(r.error)return e.jsx($,{title:S,placement:"top",arrow:!0,children:e.jsxs(V,{sx:{...o,backgroundColor:"transparent",cursor:n?"pointer":"default"},onClick:C,children:[e.jsx(ae,{variant:"determinate",value:100,size:typeof o.width=="object"?o.width.xs:o.width,sx:{color:pe[500],position:"absolute"}}),e.jsx(y,{variant:"caption",component:"div",color:"error",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.7rem",zIndex:1,fontWeight:"bold"},children:"?"})]})});if(!i)return console.warn("Could not determine tier for gem:",r),e.jsx($,{title:"Error: Unknown Gem Type",placement:"top",arrow:!0,children:e.jsx(V,{sx:{...o,backgroundColor:"transparent",opacity:.6}})});if(l)return e.jsx($,{title:S,placement:"top",arrow:!0,children:e.jsxs(V,{sx:{...o,backgroundColor:"transparent",cursor:n?"pointer":"default"},onClick:C,children:[e.jsx(ae,{variant:"determinate",value:D,size:typeof o.width=="object"?o.width.xs:o.width,sx:{color:xe[700],position:"absolute"}}),e.jsx(y,{variant:"caption",component:"div",color:"text.secondary",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.7rem",zIndex:1},children:`${Math.floor(D)}%`})]})});const w=!r.isCollecting;return e.jsx($,{title:S,placement:"top",arrow:!0,children:e.jsxs(K,{"aria-label":`${i.name} Gem ($${r.dollarAmount.toFixed(m.dollarDecimalPlaces)})`,onClick:C,disabled:!n||r.isCollecting,sx:{...o,padding:0,overflow:"visible",animation:n&&w?`${Ae} 2s ease-in-out infinite`:"none","&:hover":{backgroundColor:n&&w?"action.hover":"transparent"}},children:[e.jsx(Z,{sx:{fontSize:i.iconSize,color:i.color,transition:"transform 0.2s ease-in-out, filter 0.3s ease-in-out",animation:n&&w?`${ke} 2.2s ease-in-out infinite 0.3s`:"none","&:hover":{transform:n&&w?"scale(1.15)":"none",filter:n&&w?"brightness(120%) drop-shadow(1px 1px 3px rgba(0,0,0,0.4))":void 0}}}),r.isCollecting&&Array.from({length:m.numParticles}).map((h,v)=>e.jsx(Ge,{color:i.color,delay:Math.random()*.25,duration:.8+Math.random()*.7,targetX:`${(Math.random()-.5)*(Math.random()*150+70)}px`,targetY:`${(Math.random()-.5)*(Math.random()*150+70)}px`},v))]})})}),Ie=({initialGems:r,onAttemptCollectGem:x,onAddGem:a,gemsCollected:j,totalCollectedBalance:o})=>{const[i,D]=p.useState(()=>{try{const t=localStorage.getItem(m.localStorageKey);if(t){const s=JSON.parse(t);let c=!0;for(const f of m.gemTiers)if(typeof s[f.name]!="number"){c=!1;break}if(c)return s}}catch(t){console.error("Error loading gem values from localStorage:",t)}return ie}),[l,A]=p.useState(r),[k,n]=p.useState(!1),[C,S]=p.useState(!1),[w,h]=p.useState(""),[v,I]=p.useState(Object.entries(i).reduce((t,[s,c])=>(t[s]=String(c),t),{}));p.useEffect(()=>{try{localStorage.setItem(m.localStorageKey,JSON.stringify(i))}catch(t){console.error("Error saving gem values to localStorage:",t)}},[i]),p.useEffect(()=>{I(Object.entries(i).reduce((t,[s,c])=>(t[s]=String(c),t),{}))},[i]),p.useEffect(()=>{A(r)},[r]);const G=p.useCallback((t,s)=>{A(c=>c.map((f,b)=>b===s&&f&&f.id===t.id?{...f,isCollecting:!0}:f)),setTimeout(()=>{A(c=>{var b;const f=[...c];return f[s]&&((b=f[s])==null?void 0:b.id)===t.id&&(f[s]={...f[s],isCollecting:!1}),f})},m.particleEffectDuration)},[]),F=p.useCallback(t=>{const s=l.findIndex(b=>(b==null?void 0:b.id)===t.id);if(s===-1){console.error("Clicked gem not found in grid:",t);return}if(t.error){x&&x(t);return}if(!(!t.isCollecting&&!t.error&&t.dollarAmount>0))return;x(t)&&G(t,s)},[x,G,l,i]);p.useCallback(()=>{D(ie)},[]);const z=()=>{I(Object.entries(i).reduce((t,[s,c])=>(t[s]=String(c),t),{})),n(!0)},M=()=>{n(!1)},ee=()=>{const t={};let s=!0;for(const c of m.gemTiers){const f=v[c.name];let b=parseFloat(f);if(isNaN(b)||b<0){s=!1,console.error(`Invalid value for ${c.name}: ${f}`);break}b>100&&(b=100),t[c.name]=b}s&&D(t),n(!1)},O=(t,s)=>{I(c=>({...c,[t]:s}))},q=()=>{h(""),S(!0)},W=()=>{S(!1)},X=()=>{a&&w.trim()&&a(w.trim()),W()};return e.jsxs(V,{elevation:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",p:{xs:2,sm:3},borderRadius:3,backgroundColor:"background.default",margin:"auto",minWidth:{xs:"95%",sm:380}},children:[e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:"center",mb:2,width:"100%",justifyContent:"space-between"},children:[e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:"center",flexGrow:1,justifyContent:{xs:"center",sm:"flex-start"}},children:[e.jsxs(y,{variant:"body1",sx:{mr:{sm:2},mb:{xs:1,sm:0},fontWeight:"medium"},children:["Gems Collected: ",j," "]}),e.jsxs(y,{variant:"body1",color:"success.main",sx:{fontWeight:"medium"},children:["Total Collected: $",o.toFixed(m.dollarDecimalPlaces)," "]})]}),e.jsxs(u,{sx:{display:"flex"},children:[a&&e.jsx($,{title:"Add custom Datamine Gem Ethereum address",placement:"top",children:e.jsx(K,{"aria-label":"add gem",onClick:q,size:"small",sx:{mr:.5},children:e.jsx(Ce,{})})}),e.jsx(K,{"aria-label":"settings",onClick:z,size:"small",children:e.jsx(Se,{})})]})]}),e.jsx(te,{container:!0,spacing:{xs:1,sm:1.5},sx:{width:{xs:190,sm:330},justifyContent:"center",mb:3},children:l.map((t,s)=>e.jsx(te,{size:{xs:4},sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Ee,{gemContent:t,itemIndex:s,onAttemptCollect:F,currentGemValues:i})},(t==null?void 0:t.id)||`empty-slot-${s}`))}),e.jsxs(_,{open:k,onClose:M,fullWidth:!0,maxWidth:"xs",children:[e.jsx(H,{children:"Gem Value Settings"}),e.jsxs(J,{children:[e.jsx(ne,{sx:{mb:2},children:"Modify the dollar amount for each gem color."}),m.gemTiers.map(t=>e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Z,{sx:{color:t.color,mr:1.5,fontSize:"24px"}}),e.jsx(re,{margin:"none",label:`${t.name} Value`,type:"number",fullWidth:!0,variant:"outlined",value:v[t.name]||"",onChange:s=>O(t.name,s.target.value),InputProps:{startAdornment:e.jsx(we,{position:"start",children:"$"})},inputProps:{step:"0.0001"}})]},t.name))]}),e.jsxs(Y,{children:[e.jsx(P,{onClick:M,children:"Cancel"}),e.jsx(P,{onClick:ee,color:"secondary",variant:"outlined",children:"Save"})]})]}),e.jsxs(_,{open:C,onClose:W,fullWidth:!0,maxWidth:"sm",children:[e.jsx(H,{children:"Add Gem by Address"}),e.jsxs(J,{children:[e.jsx(ne,{sx:{mb:2},children:"Add another Gem by entering Ethereum Address. This gem will be added as your playfield and the address must be participating in the game."}),e.jsx(re,{autoFocus:!0,margin:"dense",id:"new-gem-ethereum",label:e.jsxs(e.Fragment,{children:["Ethereum Add",e.jsx(u,{component:"span",sx:{position:"absolute",left:"-9999px"},children:" "}),"ress"]}),type:"text",fullWidth:!0,variant:"outlined",value:w,onChange:t=>h(t.target.value),autoComplete:"off",inputProps:{autoComplete:"off"}})]}),e.jsxs(Y,{children:[e.jsx(P,{onClick:W,children:"Cancel"}),e.jsx(P,{onClick:X,color:"secondary",variant:"outlined",children:"Add Gem"})]})]})]})},ze=B.memo(({selectedAddress:r,balances:x,dispatch:a,error:j,ecosystem:o,marketAddressLock:i,currentAddresMintableBalance:D,currentAddressMarketAddressLock:l,connectionMethod:A,addressDetails:k,marketAddresses:n,hasWeb3:C,market:S})=>{const{mintableTokenShortName:w,navigation:h,marketAddress:v}=ye(o),{isHelpPageEnabled:I}=h,G=async d=>{if(d.preventDefault(),!r){a(C===null?{type:T.commands.Initialize,payload:{address:null}}:{type:T.commands.ConnectToWallet});return}if(!l){console.log("currentAddressMarketAddressLock is null");return}l.rewardsAmount.eq(new E(0))&&a({type:T.commands.ShowDialog,payload:{dialog:U.MarketDepositWithdraw}})},F=()=>{a({type:T.commands.ShowDialog,payload:{dialog:U.MarketDepositWithdraw}})},z=(d=void 0,g=void 0)=>{g!=="backdropClick"&&a({type:T.commands.CloseDialog})},M=()=>{if(!(!l||l.rewardsAmount.eq(new E(0))))return e.jsx(P,{color:"secondary",size:"small",variant:"outlined",onClick:()=>F(),startIcon:e.jsx(u,{display:"flex",style:{color:"#0ff"},children:e.jsx(he,{style:{color:"#00ffff"}})}),children:"Deposit/Withdraw"})},O=(()=>{const d=[];if(!n||!x)return d;for(const g of n.addresses){const N=()=>{if(g.isPaused)return"Error: Address is paused for gem minting (by the address). Please check back later!";if(g.minterAddress!==v)return"Error: This address is not paricipating in public minting."},R=g.mintAmount,de=(()=>{const ue=g.rewardsPercent===0?500:g.rewardsPercent;return R.add(R.mul(new E(ue)).div(new E(1e4)))})(),me=je({value:de.sub(R),inputToken:se.Mintable,outputToken:se.USDC,balances:x,round:6,removeCommas:!0});d.push({ethereumAddress:g.currentAddress,error:N(),dollarAmount:parseFloat(me),id:g.currentAddress})}return d})();console.log("marketAddresses:",n);const q=d=>{if(console.log("collect:",d),!l)return console.log("currentAddressMarketAddressLock is null"),!1;if(l.rewardsAmount.eq(new E(0)))return a({type:T.commands.ShowDialog,payload:{dialog:U.MarketDepositWithdraw}}),!1;const g=n==null?void 0:n.addresses.find(N=>N.currentAddress.toLowerCase()===d.ethereumAddress.toLowerCase());return g?(console.log("+ mintAmount",g.mintAmount.toString()),a({type:T.commands.Market.MarketBurnFluxTokens,payload:{address:d.ethereumAddress,amountToBurn:new E(0),gem:d}}),!0):!1},W=d=>{const g=N=>N.toLowerCase().replace(/[^a-f0-9x]/g,"");if(d&&(d=g(d.toLowerCase()),!!d&&d.length===42&&d.startsWith("0x")))return a({type:T.commands.Market.AddGemAddress,payload:{address:d}}),!0},X=()=>{if(j)return e.jsx(L,{variant:"filled",severity:"warning",children:j})},t=()=>l?e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:["My Ethereum Address:"," ",e.jsx(y,{variant:"body2",display:"inline",color:"textSecondary",children:r})]}),e.jsxs(u,{my:1,children:["Gem Game Balance (",w,"):"," ",e.jsxs(y,{variant:"body2",display:"inline",color:"textSecondary",children:[be(l.rewardsAmount,!0)," ",w]})]})]}):e.jsx(e.Fragment,{}),s=()=>{if(k)return e.jsxs(e.Fragment,{children:["Ethereum Block #",k.blockNumber.toLocaleString()]})},c=()=>l?e.jsx(e.Fragment,{children:l.rewardsAmount.eq(new E(0))?"Deposit":"Continue"}):"Connect",f=()=>{if(!(!C||!r))return v?e.jsx(Ie,{initialGems:O,onAttemptCollectGem:q,onAddGem:W,gemsCollected:S.gemsCollected.count,totalCollectedBalance:S.gemsCollected.sumDollarAmount}):e.jsx(L,{severity:"info",children:"Datamine Gems is coming to this ecosystem soon! Please select another ecosystem to continue."})},b=()=>{const g=(()=>{if(!r)return C===null?"Web3 connection required, click Connect button below":"Ethereum based wallet required, click Continue button below.";if(l&&l.rewardsAmount.eq(new E(0)))return e.jsxs(e.Fragment,{children:["Your ",w," Gem Game Balance is 0. Click Deposit button below to continue."]})})();if(g)return e.jsx(u,{mb:3,children:e.jsx(L,{severity:"info",children:g})})};return e.jsx(_,{open:!0,onClose:z,"aria-labelledby":"form-dialog-title",children:e.jsxs("form",{onSubmit:G,children:[e.jsx(H,{id:"form-dialog-title",children:e.jsxs(u,{display:"flex",alignItems:"center",alignContent:"center",children:[e.jsx(u,{display:"flex",pr:1,children:e.jsx(Z,{style:{color:"#00ffff"}})}),"Datamine Gems",e.jsx(fe,{size:"small",label:"#GameFi"})]})}),e.jsxs(J,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,children:[e.jsx(u,{display:"flex",alignItems:"center",mr:2,children:ve({ecosystem:o,connectionMethod:A,dispatch:a})}),M()]}),e.jsx(u,{my:2}),t(),e.jsx(u,{my:3,children:e.jsx(oe,{})}),X(),b(),f(),e.jsx(u,{mt:2,children:e.jsx(oe,{})})]}),e.jsxs(Y,{sx:{justifyContent:"space-between",alignItems:"center",px:3,py:1.5},children:[e.jsx(y,{variant:"caption",color:"textSecondary",children:s()}),e.jsxs(u,{children:[" ",e.jsxs(u,{display:"inline-block",mr:1,children:[" ",e.jsx(P,{onClick:z,children:"Cancel"})]}),e.jsx(P,{type:"submit",color:"secondary",size:"large",variant:"outlined",children:c()})]})]})]})})}),Xe=()=>{const{state:r,dispatch:x}=p.useContext(ge);p.useEffect(()=>{x({type:T.commands.Market.RefreshMarketAddresses,payload:{}})},[]);const{balances:a,address:j,ecosystem:o,marketAddressLock:i,currentAddresMintableBalance:D,currentAddressMarketAddressLock:l,selectedAddress:A,connectionMethod:k,addressDetails:n,marketAddresses:C,error:S,hasWeb3:w,market:h}=r;return e.jsx(ze,{balances:a,selectedAddress:j??A,error:S,dispatch:x,ecosystem:o,marketAddressLock:i,currentAddresMintableBalance:D,currentAddressMarketAddressLock:l,connectionMethod:k,addressDetails:n,marketAddresses:C,hasWeb3:w,market:h})};export{Xe as default};
