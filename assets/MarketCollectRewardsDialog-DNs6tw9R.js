import{j as e,r as p,P as V,B as u,T as y,G as te,R as z,y as xe,z as fe,v as Q}from"./index-BZuzBZi6.js";import{f as le,s as K,D as _,g as H,h as J,w as Z,x as re,i as Y,d as P,y as he,v as oe,A as U,z as ge}from"./PageFragment-BzNdZi1z.js";import{W as ye,c as G,g as je,f as be,i as k,D as L,B as we,T as ne}from"./Web3Context-B8fN7Cu1.js";import{L as $}from"./LightTooltip-O_FgK9lm.js";import{D as se}from"./DialogContentText-B22jtBWJ.js";import{I as ve}from"./InputAdornment-QVO1qaIc.js";import{a as ae}from"./CenteredLoading-BGO99cmh.js";import{g as Ce}from"./EcosystemDropdown-IQJJy-Ok.js";import"./Tooltip-Cmf0HbeC.js";import"./Popper-DwbTpRB3.js";const Se=le(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),De=le(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),m={gridSize:3,totalCells:3*3,numParticles:20,particleBaseSizeXs:"10px",particleBaseSizeSm:"14px",collectionAnimationDuration:700*2,particleEffectDuration:1500*2,dollarDecimalPlaces:4,ethAddressDisplayLength:10,gemTiers:[{name:"Bronze",color:"#CD7F32",dollarAmount:.01,iconSize:{xs:28,sm:35,md:40}},{name:"Silver",color:"#C0C0C0",dollarAmount:.05,iconSize:{xs:34,sm:42,md:50}},{name:"Gold",color:"#FFD700",dollarAmount:.1,iconSize:{xs:40,sm:50,md:60}},{name:"Epic",color:"#E040FB",dollarAmount:.25,iconSize:{xs:48,sm:60,md:75}}],localStorageKey:"datamineGemsConfig"},ie=m.gemTiers.reduce((t,x)=>(t[x.name]=x.dollarAmount,t),{}),Ae=(t,x)=>{let a;const j=m.gemTiers.map(o=>({...o,configuredDollarAmount:x[o.name]??o.dollarAmount})).sort((o,l)=>o.configuredDollarAmount-l.configuredDollarAmount);for(const o of j)if(t>=o.configuredDollarAmount)a=o;else break;return!a&&j.length>0?j[0]:a},Te=Q`
  0%, 100% { transform: translateX(0) rotate(0); }
  10%, 50%, 90% { transform: translateX(-1px) rotate(-1deg); }
  30%, 70% { transform: translateX(1px) rotate(1deg); }
`,ke=Q`
  0%, 100% { filter: brightness(100%) drop-shadow(1px 1px 2px rgba(0,0,0,0.3)); transform: scale(1); }
  50% { filter: brightness(170%) drop-shadow(2px 2px 5px rgba(255,255,255,0.7)); transform: scale(1.05); }
`,Ge=Q`
  0% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
  100% { transform: translate(var(--target-x), var(--target-y)) scale(0); opacity: 0; }
`,Ee=z.memo(({color:t,delay:x,duration:a,targetX:j,targetY:o})=>e.jsx(u,{sx:{position:"absolute",top:"50%",left:"50%",width:{xs:m.particleBaseSizeXs,sm:m.particleBaseSizeSm},height:{xs:m.particleBaseSizeXs,sm:m.particleBaseSizeSm},backgroundColor:t,borderRadius:"50%",boxShadow:`0 0 7px ${t}, 0 0 12px ${t}`,"--target-x":j,"--target-y":o,animation:`${Ge} ${a}s cubic-bezier(0.1, 0.7, 0.3, 1) ${x}s forwards`,pointerEvents:"none"}})),Ie=z.memo(({gemContent:t,itemIndex:x,onAttemptCollect:a,currentGemValues:j})=>{const o=p.useMemo(()=>({width:{xs:60,sm:80,md:100},height:{xs:60,sm:80,md:100},display:"flex",alignItems:"center",justifyContent:"center",borderRadius:2,boxSizing:"border-box",position:"relative"}),[]),{displayTier:l,computedProgress:D,showProgressBar:i,progressTargetTierConfiguredValue:A,progressTargetTierName:T}=p.useMemo(()=>{if(!t)return{displayTier:void 0,computedProgress:0,showProgressBar:!1,progressTargetTierConfiguredValue:0,progressTargetTierName:null};const h=m.gemTiers[0],v=j[h.name]??h.dollarAmount;let I=0,E=!1,F=null,B=0;const M=Ae(t.dollarAmount,j);return t.dollarAmount<v&&v>0?(I=t.dollarAmount/v*100,E=!0,F=h.name,B=v):E=!1,{displayTier:M||h,computedProgress:Math.min(100,I),showProgressBar:E,progressTargetTierConfiguredValue:B,progressTargetTierName:F}},[t,j]),s=p.useMemo(()=>t&&!t.isCollecting&&!t.error&&t.dollarAmount>0,[t]),C=p.useCallback(()=>{s&&t&&a(t)},[t,a,s]),S=p.useMemo(()=>{if(t){const h=t.ethereumAddress.substring(0,m.ethAddressDisplayLength)+"...";if(t.error)return e.jsxs(z.Fragment,{children:[e.jsx(y,{variant:"caption",display:"block",color:"error",children:t.error}),e.jsxs(y,{variant:"caption",display:"block",color:"error",children:["Address: ",h]})]});if(s)return e.jsxs(z.Fragment,{children:[e.jsxs(y,{variant:"caption",display:"block",children:["Click to Collect Reward: $",t.dollarAmount.toFixed(m.dollarDecimalPlaces)]}),e.jsxs(y,{variant:"caption",display:"block",children:["Address: ",h]})]});if(i&&T)return e.jsxs(z.Fragment,{children:[e.jsxs(y,{variant:"caption",display:"block",children:["Progress to $",A.toFixed(m.dollarDecimalPlaces)," reward: ",Math.floor(D),"%"]}),e.jsxs(y,{variant:"caption",display:"block",children:["Address: ",h]})]});if(l)return e.jsxs(z.Fragment,{children:[e.jsxs(y,{variant:"caption",display:"block",children:[l.name," Gem"]}),e.jsxs(y,{variant:"caption",display:"block",children:["Value: $",t.dollarAmount.toFixed(m.dollarDecimalPlaces)]}),e.jsxs(y,{variant:"caption",display:"block",children:["Address: ",h]}),e.jsx(y,{variant:"caption",display:"block",sx:{opacity:.7},children:"(Cannot collect)"})]})}return"Empty Slot"},[t,l,i,D,A,T,s]);if(!t)return e.jsx($,{title:"Empty Slot",placement:"top",arrow:!0,children:e.jsx(V,{sx:{...o,backgroundColor:"transparent",opacity:.6}})});if(t.error)return e.jsx($,{title:S,placement:"top",arrow:!0,children:e.jsxs(V,{sx:{...o,backgroundColor:"transparent",cursor:s?"pointer":"default"},onClick:C,children:[e.jsx(ae,{variant:"determinate",value:100,size:typeof o.width=="object"?o.width.xs:o.width,sx:{color:xe[500],position:"absolute"}}),e.jsx(y,{variant:"caption",component:"div",color:"error",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.7rem",zIndex:1,fontWeight:"bold"},children:"?"})]})});if(!l)return console.warn("Could not determine tier for gem:",t),e.jsx($,{title:"Error: Unknown Gem Type",placement:"top",arrow:!0,children:e.jsx(V,{sx:{...o,backgroundColor:"transparent",opacity:.6}})});if(i)return e.jsx($,{title:S,placement:"top",arrow:!0,children:e.jsxs(V,{sx:{...o,backgroundColor:"transparent",cursor:s?"pointer":"default"},onClick:C,children:[e.jsx(ae,{variant:"determinate",value:D,size:typeof o.width=="object"?o.width.xs:o.width,sx:{color:fe[700],position:"absolute"}}),e.jsx(y,{variant:"caption",component:"div",color:"text.secondary",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.7rem",zIndex:1},children:`${Math.floor(D)}%`})]})});const w=!t.isCollecting;return e.jsx($,{title:S,placement:"top",arrow:!0,children:e.jsxs(K,{"aria-label":`${l.name} Gem ($${t.dollarAmount.toFixed(m.dollarDecimalPlaces)})`,onClick:C,disabled:!s||t.isCollecting,sx:{...o,padding:0,overflow:"visible",animation:s&&w?`${Te} 2s ease-in-out infinite`:"none","&:hover":{backgroundColor:s&&w?"action.hover":"transparent"}},children:[e.jsx(Z,{sx:{fontSize:l.iconSize,color:l.color,transition:"transform 0.2s ease-in-out, filter 0.3s ease-in-out",animation:s&&w?`${ke} 2.2s ease-in-out infinite 0.3s`:"none","&:hover":{transform:s&&w?"scale(1.15)":"none",filter:s&&w?"brightness(120%) drop-shadow(1px 1px 3px rgba(0,0,0,0.4))":void 0}}}),t.isCollecting&&Array.from({length:m.numParticles}).map((h,v)=>e.jsx(Ee,{color:l.color,delay:Math.random()*.25,duration:.8+Math.random()*.7,targetX:`${(Math.random()-.5)*(Math.random()*150+70)}px`,targetY:`${(Math.random()-.5)*(Math.random()*150+70)}px`},v))]})})}),Be=({initialGems:t,onAttemptCollectGem:x,onAddGem:a,gemsCollected:j,totalCollectedBalance:o})=>{const[l,D]=p.useState(()=>{try{const r=localStorage.getItem(m.localStorageKey);if(r){const n=JSON.parse(r);let c=!0;for(const f of m.gemTiers)if(typeof n[f.name]!="number"){c=!1;break}if(c)return n}}catch(r){console.error("Error loading gem values from localStorage:",r)}return ie}),[i,A]=p.useState(t),[T,s]=p.useState(!1),[C,S]=p.useState(!1),[w,h]=p.useState(""),[v,I]=p.useState(Object.entries(l).reduce((r,[n,c])=>(r[n]=String(c),r),{}));p.useEffect(()=>{try{localStorage.setItem(m.localStorageKey,JSON.stringify(l))}catch(r){console.error("Error saving gem values to localStorage:",r)}},[l]),p.useEffect(()=>{I(Object.entries(l).reduce((r,[n,c])=>(r[n]=String(c),r),{}))},[l]),p.useEffect(()=>{A(t)},[t]);const E=p.useCallback((r,n)=>{A(c=>c.map((f,b)=>b===n&&f&&f.id===r.id?{...f,isCollecting:!0}:f)),setTimeout(()=>{A(c=>{var b;const f=[...c];return f[n]&&((b=f[n])==null?void 0:b.id)===r.id&&(f[n]={...f[n],isCollecting:!1}),f})},m.particleEffectDuration)},[]),F=p.useCallback(r=>{const n=i.findIndex(b=>(b==null?void 0:b.id)===r.id);if(n===-1){console.error("Clicked gem not found in grid:",r);return}if(r.error){x&&x(r);return}if(!(!r.isCollecting&&!r.error&&r.dollarAmount>0))return;x(r)&&E(r,n)},[x,E,i,l]);p.useCallback(()=>{D(ie)},[]);const B=()=>{I(Object.entries(l).reduce((r,[n,c])=>(r[n]=String(c),r),{})),s(!0)},M=()=>{s(!1)},ee=()=>{const r={};let n=!0;for(const c of m.gemTiers){const f=v[c.name];let b=parseFloat(f);if(isNaN(b)||b<0){n=!1,console.error(`Invalid value for ${c.name}: ${f}`);break}b>100&&(b=100),r[c.name]=b}n&&D(r),s(!1)},O=(r,n)=>{I(c=>({...c,[r]:n}))},q=()=>{h(""),S(!0)},W=()=>{S(!1)},X=()=>{a&&w.trim()&&a(w.trim()),W()};return e.jsxs(V,{elevation:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",p:{xs:2,sm:3},borderRadius:3,backgroundColor:"background.default",margin:"auto",minWidth:{xs:"95%",sm:380}},children:[e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:"center",mb:2,width:"100%",justifyContent:"space-between"},children:[e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:"center",flexGrow:1,justifyContent:{xs:"center",sm:"flex-start"}},children:[e.jsxs(y,{variant:"body1",sx:{mr:{sm:2},mb:{xs:1,sm:0},fontWeight:"medium"},children:["Gems Collected: ",j," "]}),e.jsxs(y,{variant:"body1",color:"success.main",sx:{fontWeight:"medium"},children:["Total Collected: $",o.toFixed(m.dollarDecimalPlaces)," "]})]}),e.jsxs(u,{sx:{display:"flex"},children:[a&&e.jsx($,{title:"Add custom Datamine Gem Ethereum address",placement:"top",children:e.jsx(K,{"aria-label":"add gem",onClick:q,size:"small",sx:{mr:.5},children:e.jsx(Se,{})})}),e.jsx(K,{"aria-label":"settings",onClick:B,size:"small",children:e.jsx(De,{})})]})]}),e.jsx(te,{container:!0,spacing:{xs:1,sm:1.5},sx:{width:{xs:190,sm:330},justifyContent:"center",mb:3},children:i.map((r,n)=>e.jsx(te,{size:{xs:4},sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Ie,{gemContent:r,itemIndex:n,onAttemptCollect:F,currentGemValues:l})},(r==null?void 0:r.id)||`empty-slot-${n}`))}),e.jsxs(_,{open:T,onClose:M,fullWidth:!0,maxWidth:"xs",children:[e.jsx(H,{children:"Gem Value Settings"}),e.jsxs(J,{children:[e.jsx(se,{sx:{mb:2},children:"Modify the dollar amount for each gem color."}),m.gemTiers.map(r=>e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Z,{sx:{color:r.color,mr:1.5,fontSize:"24px"}}),e.jsx(re,{margin:"none",label:`${r.name} Value`,type:"number",fullWidth:!0,variant:"outlined",value:v[r.name]||"",onChange:n=>O(r.name,n.target.value),InputProps:{startAdornment:e.jsx(ve,{position:"start",children:"$"})},inputProps:{step:"0.0001"}})]},r.name))]}),e.jsxs(Y,{children:[e.jsx(P,{onClick:M,children:"Cancel"}),e.jsx(P,{onClick:ee,color:"secondary",variant:"outlined",children:"Save"})]})]}),e.jsxs(_,{open:C,onClose:W,fullWidth:!0,maxWidth:"sm",children:[e.jsx(H,{children:"Add Gem by Address"}),e.jsxs(J,{children:[e.jsx(se,{sx:{mb:2},children:"Add another Gem by entering Ethereum Address. This gem will be added as your playfield and the address must be participating in the game."}),e.jsx(re,{autoFocus:!0,margin:"dense",id:"new-gem-ethereum",label:e.jsxs(e.Fragment,{children:["Ethereum Add",e.jsx(u,{component:"span",sx:{position:"absolute",left:"-9999px"},children:" "}),"ress"]}),type:"text",fullWidth:!0,variant:"outlined",value:w,onChange:r=>h(r.target.value),autoComplete:"off",inputProps:{autoComplete:"off"}})]}),e.jsxs(Y,{children:[e.jsx(P,{onClick:W,children:"Cancel"}),e.jsx(P,{onClick:X,color:"secondary",variant:"outlined",children:"Add Gem"})]})]})]})},ze=z.memo(({selectedAddress:t,balances:x,dispatch:a,error:j,ecosystem:o,marketAddressLock:l,currentAddresMintableBalance:D,currentAddressMarketAddressLock:i,connectionMethod:A,addressDetails:T,marketAddresses:s,hasWeb3:C,market:S})=>{const{mintableTokenShortName:w,navigation:h,marketAddress:v}=je(o),{isHelpPageEnabled:I}=h,E=async d=>{if(d.preventDefault(),!t){a(C===null?{type:G.commands.Initialize,payload:{address:null}}:{type:G.commands.ConnectToWallet});return}if(!i){console.log("currentAddressMarketAddressLock is null");return}i.rewardsAmount.eq(new k(0))&&a({type:G.commands.ShowDialog,payload:{dialog:L.MarketDepositWithdraw}})},F=()=>{a({type:G.commands.ShowDialog,payload:{dialog:L.MarketDepositWithdraw}})},B=(d=void 0,g=void 0)=>{g!=="backdropClick"&&a({type:G.commands.CloseDialog})},M=()=>{if(!(!i||i.rewardsAmount.eq(new k(0))))return e.jsx(P,{color:"secondary",size:"small",variant:"outlined",onClick:()=>F(),startIcon:e.jsx(u,{display:"flex",style:{color:"#0ff"},children:e.jsx(ge,{style:{color:"#00ffff"}})}),children:"Deposit/Withdraw"})},O=(()=>{const d=[];if(!s||!x)return d;for(const g of s.addresses){const N=()=>{if(g.isPaused)return"Error: Address is paused for gem minting (by the address). Please check back later!";if(g.minterAddress!==v)return"Error: This address is not paricipating in public minting."},R=g.mintAmount,me=(()=>{const pe=g.rewardsPercent===0?500:g.rewardsPercent;return R.add(R.mul(new k(pe)).div(new k(1e4)))})(),ue=be({value:me.sub(R),inputToken:ne.Mintable,outputToken:ne.USDC,balances:x,round:6,removeCommas:!0});d.push({ethereumAddress:g.currentAddress,error:N(),dollarAmount:parseFloat(ue),id:g.currentAddress})}return d})();console.log("marketAddresses:",s);const q=d=>{if(console.log("collect:",d),!i)return console.log("currentAddressMarketAddressLock is null"),!1;if(i.rewardsAmount.eq(new k(0)))return a({type:G.commands.ShowDialog,payload:{dialog:L.MarketDepositWithdraw}}),!1;const g=s==null?void 0:s.addresses.find(N=>N.currentAddress.toLowerCase()===d.ethereumAddress.toLowerCase());return g?(console.log("+ mintAmount",g.mintAmount.toString()),a({type:G.commands.Market.MarketBurnFluxTokens,payload:{address:d.ethereumAddress,amountToBurn:new k(0),gem:d}}),!0):!1},W=d=>{const g=N=>N.toLowerCase().replace(/[^a-f0-9x]/g,"");if(d&&(d=g(d.toLowerCase()),!!d&&d.length===42&&d.startsWith("0x")))return a({type:G.commands.Market.AddGemAddress,payload:{address:d}}),!0},X=()=>{if(j)return e.jsx(U,{variant:"filled",severity:"warning",children:j})},r=()=>i?e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:["My Ethereum Address:"," ",e.jsx(y,{variant:"body2",display:"inline",color:"textSecondary",children:t})]}),e.jsxs(u,{my:1,children:["Gem Game Balance (",w,"):"," ",e.jsxs(y,{variant:"body2",display:"inline",color:"textSecondary",children:[we(i.rewardsAmount,!0)," ",w]})]})]}):e.jsx(e.Fragment,{}),n=()=>{if(T)return e.jsxs(e.Fragment,{children:["Ethereum Block #",T.blockNumber.toLocaleString()]})},c=()=>i?e.jsx(e.Fragment,{children:i.rewardsAmount.eq(new k(0))?"Deposit":"Continue"}):"Connect",f=()=>{if(!(!C||!t))return v?e.jsx(Be,{initialGems:O,onAttemptCollectGem:q,onAddGem:W,gemsCollected:S.gemsCollected.count,totalCollectedBalance:S.gemsCollected.sumDollarAmount}):e.jsx(U,{severity:"info",children:"Datamine Gems is coming to this ecosystem soon! Please select another ecosystem to continue."})},b=()=>{const g=(()=>{if(!t)return C===null?"Web3 connection required, click Connect button below":"Ethereum based wallet required, click Continue button below.";if(i&&i.rewardsAmount.eq(new k(0)))return e.jsxs(e.Fragment,{children:["Your ",w," Gem Game Balance is 0. Click Deposit button below to continue."]})})();if(g)return e.jsx(u,{mb:3,children:e.jsx(U,{severity:"info",children:g})})},ce=()=>{if(!(i&&t&&i.rewardsAmount.gt(new k(0))))return e.jsx(P,{type:"submit",color:"secondary",size:"large",variant:"outlined",children:c()})};return e.jsx(_,{open:!0,onClose:B,"aria-labelledby":"form-dialog-title",children:e.jsxs("form",{onSubmit:E,children:[e.jsx(H,{id:"form-dialog-title",children:e.jsxs(u,{display:"flex",alignItems:"center",alignContent:"center",children:[e.jsx(u,{display:"flex",pr:1,children:e.jsx(Z,{style:{color:"#00ffff"}})}),"Datamine Gems",e.jsx(he,{size:"small",label:"#GameFi"})]})}),e.jsxs(J,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,children:[e.jsx(u,{display:"flex",alignItems:"center",mr:2,children:Ce({ecosystem:o,connectionMethod:A,dispatch:a})}),M()]}),e.jsx(u,{my:2}),r(),e.jsx(u,{my:3,children:e.jsx(oe,{})}),X(),b(),f(),e.jsx(u,{mt:2,children:e.jsx(oe,{})})]}),e.jsxs(Y,{sx:{justifyContent:"space-between",alignItems:"center",px:3,py:1.5},children:[e.jsx(y,{variant:"caption",color:"textSecondary",children:n()}),e.jsxs(u,{children:[" ",e.jsxs(u,{display:"inline-block",mr:1,children:[" ",e.jsx(P,{onClick:B,children:"Cancel"})]}),ce()]})]})]})})}),Ue=()=>{const{state:t,dispatch:x}=p.useContext(ye);p.useEffect(()=>{x({type:G.commands.Market.RefreshMarketAddresses,payload:{}})},[]);const{balances:a,address:j,ecosystem:o,marketAddressLock:l,currentAddresMintableBalance:D,currentAddressMarketAddressLock:i,selectedAddress:A,connectionMethod:T,addressDetails:s,marketAddresses:C,error:S,hasWeb3:w,market:h}=t;return e.jsx(ze,{balances:a,selectedAddress:j??A,error:S,dispatch:x,ecosystem:o,marketAddressLock:l,currentAddresMintableBalance:D,currentAddressMarketAddressLock:i,connectionMethod:T,addressDetails:s,marketAddresses:C,hasWeb3:w,market:h})};export{Ue as default};
